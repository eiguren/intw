#!/usr/bin/env bash


# Run all necessary QE calculations
make calculation
if [ $? -ne 0 ]; then
  exit 1
fi


# Run pw2intw
@QE_BUILD_DIR@/bin/pw2intw.x < pw2intw.in | tee pw2intw.out
if [ -f CRASH ]; then
  exit 1
fi

# Run the matrix-element calculation
rm -rf ep_mat.dat*
cp ../intw.in ./
@CMAKE_BINARY_DIR@/src/utilities/ep_melements.x < intw.in | tee intw.out


# Compare calculation
@Python3_EXECUTABLE@ compare_matrix_elements.py
if [ $? -ne 0 ]; then
  exit 1
fi
