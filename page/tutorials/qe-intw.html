<!-- -*- mode: jinja2 -*- -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="Welcome to the documentation for the INTW project">
    <meta name="author" content="INTW group" >
    <link rel="icon" href="../../favicon.png">

    <title>Quantum ESPRESSO &ndash; INTW</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Font Awesome -->
    <link href="../../css/fontawesome.min.css" rel="stylesheet">
    <link href="../../css/brands.min.css" rel="stylesheet">
    <link href="../../css/regular.min.css" rel="stylesheet">
    <link href="../../css/solid.min.css" rel="stylesheet">
    <link href="../../css/v4-font-face.min.css" rel="stylesheet">
    <link href="../../css/v4-shims.min.css" rel="stylesheet">
    <!-- MathJax -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { equationNumbers: { autoNumber: "AMS" } }
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async
            integrity="sha256-DViIOMYdwlM/axqoGDPeUyf0urLoHMN4QACBKyB58Uw=" crossorigin="anonymous"></script>
    <!-- Other scripts and stylesheets -->
    <link href="../../css/local.css" rel="stylesheet">
    <link href="../../css/pygments.css" rel="stylesheet">
    <script src="../../js/svg-pan-zoom.min.js"></script>
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="container-fluid mb-sm-4 mb-xl-2">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="../../index.html">INTW </a>
          <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar"
                  aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon">
          </button>

          <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="../index.html">User Guide</a></li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../lists/files.html">Source Files</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="../../lists/modules.html">Modules</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../../lists/procedures.html">Procedures</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../../lists/programs.html">Programs</a>
                </li>
            </ul>
              <div class="d-flex align-items-end flex-grow-1">
                <form action="../../search.html" role="search" class="ms-auto">
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
                </form>
              </div>
          </div><!--/.nav-collapse -->
        </div>
      </nav>
    </div>

    <div class="container">
  <div class="row">
    <h1>Quantum ESPRESSO</h1>
    <div class="container p-2 mb-4 bg-light border rounded-3">
      <div class="row align-items-center justify-content-between">
        <div class="col">
          <ul class="list-inline" style="margin-bottom:0px; display:inline">
          </ul>
        </div>
        <div class="col">
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb justify-content-end mb-0">
                <li class="breadcrumb-item"><a href='../index.html'>User Guide</a></li>
                <li class="breadcrumb-item"><a href='index.html'>Tutorials</a></li>
              <li class="breadcrumb-item active" aria-current="page">Quantum ESPRESSO</li>
            </ol>
          </nav>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
      <div class="col-3">
        <div class="card card-body bg-light" id="sidebar-toc">
          <ul class="nav flex-column align-items">
            <li class="nav-item">
              <a class="nav-link" href="../index.html">User Guide</a>
            </li>
          </ul>
          <hr>
          <nav class="nav nav-pills flex-column">
              <a class="nav-link" href="index.html">Tutorials</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link active disabled" href="qe-intw.html">Quantum ESPRESSO</a>
              <a class="nav-link" href="siesta-intw.html">SIESTA</a>

                </nav>
              <a class="nav-link" href="../tests.html">Test suite</a>
              <a class="nav-link" href="../other.html">Other</a>
          </nav>
        </div>
      </div>

    <div class="col-9" id='text'>
      <h1 id="electron-phonon-interpolation-with-intw">Electron-phonon interpolation with INTW</h1>
<h3 id="table-of-contents">Table of contents</h3>
<ul>
<li><a href="#preparation-of-qe-data">Preparation of QE data</a></li>
<li><a href="#intw-wannier90-interface">INTW-Wannier90 interface</a></li>
<li><a href="#triangulation-of-the-fermi-surface">Triangulation of the Fermi surface</a></li>
<li><a href="#electron-phonon-by-method-i">Electron-phonon by Method I</a></li>
<li><a href="#electron-phonon-by-method-ii">Electron-phonon by Method II</a></li>
</ul>
<p>In this tutorial we showcase INTW electron-phonon interpolation utilities taking hexagonal MgB2 as example and using Quantum ESPRESSO (QE) as DFT code. As part of the workflow, we also make use of the INTW-Wannier90 interface and the Fermi surface (FS) triangulation utility.</p>
<p>Note, the provided <code>intw.in</code> contains all the necessary input to perform the calculations described below until the interpolation by Method I. For Method II, the <code>&amp;elphon</code> block has to be rewritten.</p>
<h2 id="preparation-of-qe-data">Preparation of QE data</h2>
<p>Here we do <code>pw.x</code> and <code>ph.x</code> calculations with the 6.7Max version of QE. In the working directory, we find:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>tree
.
├──<span class="w"> </span>B.pz-vbc.UPF
├──<span class="w"> </span>create_intw_q_dirs.in
├──<span class="w"> </span>intw.in
├──<span class="w"> </span>intw_wann.in
├──<span class="w"> </span>mgb2_a2F.png
├──<span class="w"> </span>mgb2_bands.png
├──<span class="w"> </span>mgb2_dos.png
├──<span class="w"> </span>mgb2_ph_bands.png
├──<span class="w"> </span>mgb2_ph_dos.png
├──<span class="w"> </span>mgb2.pw2intw.in
├──<span class="w"> </span>mgb2.scf.in
├──<span class="w"> </span>mgb2.win
├──<span class="w"> </span>Mg.pz-n-vbc.UPF
├──<span class="w"> </span>phonons_333
│<span class="w">   </span>└──<span class="w"> </span>mgb2.ph.in
└──<span class="w"> </span>Tutorial.txt
</code></pre></div>

<p>With the pseudo files and the self-consistent (scf) calculation input, we run <code>pw.x</code>:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span><span class="si">${</span><span class="nv">QE_dir</span><span class="si">}</span>/pw.x<span class="w"> </span>&lt;<span class="w"> </span>mgb2.scf.in<span class="w"> </span>&gt;<span class="w"> </span>mgb2.scf.out
</code></pre></div>

<p>This electronic calculation uses a $N_k$ = 12x12x12 grid. For the phonons we set a grid $N_q$ = 3x3x3.</p>
<p><code>pw2intw.x</code> reads the phonon data from an individual directory <code>qq${iq}/</code> for each q-point index iq. Therefore, <code>ph.x</code> must be executed for one q-point at a time. For the <code>ph.x</code> input preparation and execution, a script can be used adapted to the needs of the user, or, <code>create_intw_q_dirs.x</code> code provided by INTW can be used. In this example <code>create_intw_q_dirs.in</code> is provided for this purpose:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>cat<span class="w"> </span>create_intw_q_dirs.in
<span class="p">&amp;</span>inputpp
<span class="w">  </span><span class="nv">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;mgb2&quot;</span>
<span class="w">  </span><span class="nv">phdir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./phonons_333/&quot;</span>
<span class="w">  </span><span class="nv">nq1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span>,<span class="w"> </span><span class="nv">nq2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span>,<span class="w"> </span><span class="nv">nq3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span>
<span class="w">  </span><span class="nv">reference_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;mgb2.ph.in&quot;</span>
/
</code></pre></div>

<p>Where <code>reference_file</code> located inside <code>phdir</code> is:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>cat<span class="w"> </span>phonons_333/mgb2.ph.in
phonons<span class="w"> </span><span class="k">for</span><span class="w"> </span>MgB2
<span class="p">&amp;</span>inputph
<span class="w"> </span><span class="nv">outdir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;./&#39;</span>
<span class="w"> </span><span class="nv">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;mgb2&#39;</span>
<span class="w"> </span><span class="nv">trans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>.true.
<span class="w"> </span><span class="nv">ldisp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>.false.
<span class="w"> </span><span class="nv">tr2_ph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>.0d-16
<span class="w"> </span><span class="nv">fildvscf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dvscf&#39;</span>
<span class="w"> </span><span class="nv">fildyn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;mgb2.dyn&#39;</span>
<span class="w"> </span><span class="nv">verbosity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;high&#39;</span>
/
</code></pre></div>

<p>Note that, because <code>ldisp</code> is set to <code>.false.</code>, <code>ph.x</code> will expect a q-point at the end of the file, which will be added by <code>create_intw_q_dirs.x</code> automatically. Now we run:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span><span class="si">${</span><span class="nv">QE_dir</span><span class="si">}</span>/create_intw_q_dirs.x<span class="w"> </span>&lt;<span class="w"> </span>create_intw_q_dirs.in<span class="w"> </span>&gt;<span class="w"> </span>create_intw_q_dirs.out
</code></pre></div>

<p>This will also create the <code>qlist.txt</code> file inside <code>phdir</code>, which contains a list of the irreducible q-points:</p>
<div class="codehilite"><pre><span></span><code>cat phonons_333/qlist.txt
  1      0.0000000000      0.0000000000      0.0000000000
  2      0.0000000000      0.0000000000      0.2918855809
  3      0.0000000000      0.3849001795      0.0000000000
  4      0.0000000000      0.3849001795      0.2918855809
  5      0.3333333333      0.5773502692      0.0000000000
  6      0.3333333333      0.5773502692      0.2918855809
</code></pre></div>

<p>Then we run the <code>ph.x</code> calculation for each q-point:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>phonons_333/qq1
$<span class="w"> </span>cp<span class="w"> </span>-r<span class="w"> </span>../../mgb2.save<span class="w"> </span>.
$<span class="w"> </span><span class="si">${</span><span class="nv">QE_dir</span><span class="si">}</span>/ph.x<span class="w"> </span>&lt;<span class="w"> </span>mgb2.ph.in<span class="w"> </span>&gt;<span class="w"> </span>mgb2.ph.out
$<span class="w"> </span>rm<span class="w"> </span>-fr<span class="w"> </span>mgb2.save
<span class="nb">cd</span><span class="w"> </span>../..
</code></pre></div>

<p>And so on until all phonon calculations are completed. Back into the working directory and we are ready to transform the QE data into a format suitable for INTW by running <code>pw2intw.x</code>:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span><span class="si">${</span><span class="nv">QE_dir</span><span class="si">}</span>/pw2intw.x<span class="w"> </span>&lt;<span class="w"> </span>mgb2.pw2intw.in<span class="w"> </span>&gt;<span class="w"> </span>mgb2.pw2intw.out
</code></pre></div>

<p>This will create <code>mgb2.save.intw</code> directory, where all the data required by INTW is stored:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>tree<span class="w"> </span>mgb2.save.intw
mgb2.save.intw
├──<span class="w"> </span><span class="m">1</span>-KBPP.txt
├──<span class="w"> </span><span class="m">2</span>-KBPP.txt
├──<span class="w"> </span>crystal.dat
├──<span class="w"> </span>gvectors.dat
├──<span class="w"> </span>iGlist.dat
├──<span class="w"> </span>irrq_patterns.dat
├──<span class="w"> </span>kpoints.dat
├──<span class="w"> </span>mgb2.dvscf_q1
...
├──<span class="w"> </span>mgb2.dvscf_q6
├──<span class="w"> </span>mgb2.dyn_q1
...
├──<span class="w"> </span>mgb2.dyn_q6
├──<span class="w"> </span>scf_rhor.dat
├──<span class="w"> </span>scf_vr.dat
├──<span class="w"> </span>wfc00001.dat
...
└──<span class="w"> </span>wfc00133.dat
</code></pre></div>

<p><a href="#electron-phonon-interpolation-with-intw">Back to top :arrow_heading_up:</a></p>
<h2 id="intw-wannier90-interface">INTW-Wannier90 interface</h2>
<p>As usual, we run Wannier90 in preprocessing mode to obtain the <code>mgb2.nnkp</code> file with <code>mgb2.win</code> as input:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span><span class="si">${</span><span class="nv">W90_dir</span><span class="si">}</span>/wannier90.x<span class="w"> </span>-pp<span class="w"> </span>mgb2
</code></pre></div>

<p>The QE calculation produced 8 bands and with the settings</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>head<span class="w"> </span>mgb2.win

<span class="nv">num_bands</span><span class="w">       </span><span class="o">=</span><span class="w">  </span><span class="m">8</span>
<span class="nv">num_wann</span><span class="w">        </span><span class="o">=</span><span class="w">  </span><span class="m">5</span>
<span class="nv">dis_froz_max</span><span class="w">    </span><span class="o">=</span><span class="w">  </span><span class="m">9</span>.0
...
</code></pre></div>

<p>We will disentangle to work with 5 bands after unitary rotation, the lowest in the energy range. In the following <code>intw.in</code> input we have selected <code>use_exclude_bands = 'wannier'</code>. Here we indicate in the <code>&amp;input</code> block the grid and the Fermi energy from mgb2.scf.out, which is needed later:</p>
<div class="codehilite"><pre><span></span><code>&amp;input
 outdir = &#39;./&#39;
 prefix = &#39;mgb2&#39;
 nk1 = 12
 nk2 = 12
 nk3 = 12
 TR_symmetry = .false.
 use_exclude_bands = &#39;wannier&#39;
 chemical_potential = 7.3852
/
</code></pre></div>

<p>The <code>&amp;intw2W</code> block is the input for <code>intw2W90.x</code>, which will generate <code>mgb2.eig</code>, <code>mgb2.mmn</code> and <code>mgb2.amn</code> upon symmetry rotation of the wavefunctions and applying the convolution formula described in the paper.</p>
<div class="codehilite"><pre><span></span><code>&amp;intw2W
 intw2W_fullzone = .false.
 intw2W_method = &#39;CONVOLUTION&#39;
/
</code></pre></div>

<p>We can run <code>intw2W90.x</code>, then Wannier90 normally, and finally <code>w902intw.x</code>.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span><span class="si">${</span><span class="nv">INTW_dir</span><span class="si">}</span>/intw2W90.x<span class="w"> </span>&lt;<span class="w"> </span>intw.in
$<span class="w"> </span><span class="si">${</span><span class="nv">W90_dir</span><span class="si">}</span>/wannier90.x<span class="w"> </span>mgb2
$<span class="w"> </span><span class="si">${</span><span class="nv">INTW_dir</span><span class="si">}</span>/w902intw.x<span class="w"> </span>&lt;<span class="w"> </span>intw.in
</code></pre></div>

<p>This produces the files <code>mgb2.u_mesh</code> and <code>mgb2_hr_intw.dat</code>, containing the unitary rotations and the Hamiltonian in the real space basis, respectively. With the options in <code>&amp;DOS</code> and the <code>K_PATH</code> card, we can interpolate the band structure and obtain a density of states at this point:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span><span class="si">${</span><span class="nv">INTW_dir</span><span class="si">}</span>/interpolate.x<span class="w"> </span>&lt;<span class="w"> </span>intw.in
</code></pre></div>

<div class="codehilite"><pre><span></span><code>gnuplot&gt; do for [ qpt in  &quot;0.000000E+00 0.622657E+00 0.982148E+00 0.170113E+01 0.217332E+01 0.279597E+01 0.315546E+01 0.387445E+01&quot; ]{set arrow nohead from qpt,graph 0 to qpt,graph 1 lc &quot;black&quot;}
gnuplot&gt; set xtics (&quot;{/Symbol G}&quot; 0.000000E+00, &quot;M&quot; 0.622657E+00, &quot;K&quot; 0.982148E+00, &quot;{/Symbol G}&quot; 0.170113E+01, &quot;A&quot; 0.217332E+01, &quot;L&quot; 0.279597E+01, &quot;H&quot; 0.315546E+01, &quot;A&quot; 0.387445E+01)
gnuplot&gt; set zeroaxis
gnuplot&gt; set ylabel &#39;E-E_F (eV)&#39;
gnuplot&gt; p &#39;mgb2.bnd_int&#39; u 1:2 w l
</code></pre></div>

<p><img alt="image" src="mgb2_bands.png">
<img alt="image" src="mgb2_dos.png"></p>
<p><a href="#electron-phonon-interpolation-with-intw">Back to top :arrow_heading_up:</a></p>
<h2 id="triangulation-of-the-fermi-surface">Triangulation of the Fermi surface</h2>
<p>The <code>triFS.x</code> utility needs the input file blocks <code>&amp;tri_FS</code> and <code>&amp;FS_opt</code>. At this point, a different energy isosurface can be selected. The <code>mgb2_hr_intw.dat</code> file is used internally by triFS.x.</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span><span class="si">${</span><span class="nv">INTW_dir</span><span class="si">}</span>/triFS.x<span class="w"> </span>&lt;<span class="w"> </span>intw.in
</code></pre></div>

<p>Only some of the files produced by <code>triFS.x</code> are needed in the electron-phonon calculation later on:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>ls
...
mgb2.<span class="si">${</span><span class="nv">ish</span><span class="si">}</span>_FS_tri.off
mgb2.<span class="si">${</span><span class="nv">ish</span><span class="si">}</span>_FS_tri_v_k.dat
mgb2.<span class="si">${</span><span class="nv">ish</span><span class="si">}</span>_IBZ_FS_tri.off
mgb2.<span class="si">${</span><span class="nv">ish</span><span class="si">}</span>_IBZ_FS_tri_v_k.dat
...
</code></pre></div>

<p>where <code>ish</code>=3,4,5 are band indices of the Fermi sheets identified by <code>triFS.x</code>. :heavy_exclamation_mark:NOTE:  bands are labelled according to <code>set_num_bands</code>. If we had used <code>exclude_bands</code> earlier, the labels would count the bands in the non-excluded set. These <code>*.off</code> files contain the triangulated FS in the irreducible Brillouin zone wedge (IBZ) and in the full zone. The <code>*v_k.dat</code> files contain the Fermi velocities.</p>
<p><a href="#electron-phonon-interpolation-with-intw">Back to top :arrow_heading_up:</a></p>
<h2 id="electron-phonon-by-method-i">Electron-phonon by Method I</h2>
<p>The <code>&amp;ph</code> input block describes the phonon grid and dynamical matrix options. In this case, we chose to read the $C(q)$ files, stored in directory `mgb2.save.intw', and to apply an acoustic sum rule:</p>
<div class="codehilite"><pre><span></span><code>&amp;ph
 nq1 = 3
 nq2 = 3
 nq3 = 3
 nqirr = 6
 qlist = &quot;./phonons_333/qlist.txt&quot;
 read_for_dynmat = &#39;dynq&#39;
 apply_asr = .true.
/
</code></pre></div>

<p>Together with the options in <code>&amp;DOS_ph</code> and the card <code>Q_PATH</code> in the input, we can calculate the phonon bands by doing:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span><span class="si">${</span><span class="nv">INTW_dir</span><span class="si">}</span>/interpolate_phonons.x<span class="w"> </span>&lt;<span class="w"> </span>intw.in
</code></pre></div>

<p>and using Gnuplot with the same <code>xtics</code> for the q-path as in the previous band structure figure:</p>
<div class="codehilite"><pre><span></span><code>...
gnuplot&gt; unset key
gnuplot&gt; set ylabel &#39;omega (meV)&#39;
gnuplot&gt; set linestyle 1 lc rgb &quot;red&quot; lw 2
gnuplot&gt; p &#39;mgb2.qbnd_int&#39; u 1:2 w l ls 1, &#39;&#39; u 1:3 w l ls 1, &#39;&#39; u 1:4 w l ls 1,&#39;&#39; u 1:5 w l ls 1,&#39;&#39; u 1:6 w l ls 1,&#39;&#39; u 1:7 w l ls 1,&#39;&#39; u 1:8  w l ls 1,&#39;&#39; u 1:9  w l ls 1,&#39;&#39; u 1:10  w l ls 1
gnuplot&gt; reset
gnuplot&gt; set xlabel &#39;omega (Ry)&#39;
gnuplot&gt; p &#39;mgb2.qdos_int&#39; w l
</code></pre></div>

<p><img alt="image" src="mgb2_ph_bands.png">
<img alt="image" src="mgb2_ph_dos.png"></p>
<p>The <code>ep_interp_on_trFS_dV.x</code> utility calculates the electron-phonon matrix elements for $k+q,k$ pairs on the Fermi surface, including inter-sheet ones, by interpolation of the induced potential (see A. Eiguren and C. Ambrosch-Draxl, Phys. Rev. B 78 (2008) 045124). The interpolation method has to be explicity invoked by the flag <code>ep_interp_method</code>. In this example we specify that the sheets labelled 3-5 are to be used with the <code>ep_interp_bands</code> option and the range. The k-points will be read in from the <code>.off</code> files. :heavy_exclamation_mark:NOTE:  we must provide the commands for running non-self-consistent (nscf) QE calculations and the name of the QE input file of the scf calculation, as INTW will use it as a template to generate the nscf calculations. Here machine options can be introduced, for example, to run <code>pw.x</code> in parallel.</p>
<div class="codehilite"><pre><span></span><code><span class="err">&amp;</span>elphon
<span class="w"> </span>nscf_code<span class="w"> </span>=<span class="w"> </span>&#39;QE&#39;
<span class="w"> </span>ep_interp_method<span class="w"> </span>=<span class="w"> </span>&#39;dV_interpolate&#39;
<span class="w"> </span>ep_interp_bands<span class="w"> </span>=<span class="w"> </span>&#39;ef_crossing&#39;
<span class="w"> </span>nfs_sheets_initial=3
<span class="w"> </span>nfs_sheets_final=5
<span class="w"> </span>command_pw<span class="w"> </span>=<span class="w"> </span>&quot;<span class="cp">${</span><span class="n">QE_dir</span><span class="cp">}</span>/pw.x&quot;
<span class="w"> </span>command_pw2intw<span class="w"> </span>=<span class="w"> </span>&quot;{QE_dir}/pw2intw.x&quot;
<span class="w"> </span>file_pw<span class="w"> </span>=<span class="w"> </span>&#39;mgb2.scf.in&#39;
/
</code></pre></div>

<p>Upon running</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span><span class="si">${</span><span class="nv">INTW_dir</span><span class="si">}</span>/ep_interp_on_trFS_dV.x<span class="w"> </span>&lt;<span class="w"> </span>intw.in
</code></pre></div>

<p>the matrix elements, fully resolved into spin blocks if nspin=2, are calculated and printed in file <code>mgb2_ep_interp.dat</code> with this format:</p>
<div class="codehilite"><pre><span></span><code>do js=1,nspin
   do is=1,nspin
      write(unit_ep,fmt=&quot;(6i6,100e16.6)&quot;) ibp, iksp, ikp, ib, iks, ik,  &amp;
         (aep_mat_el(ikp,ik,js,is,iat), iat=1,3*nat)
   end do
end do
</code></pre></div>

<p>where <code>ibp</code> and <code>ib</code> are sheet indices, <code>iksp</code> and <code>iks</code> are the k-point indices inside the sheet, <code>ikp</code> and <code>ik</code> are global k-point counters, and iat runs over phonon modes. Here <code>iksp</code> and <code>iks</code> are taken from the triangulation on the full zone and the IBZ.</p>
<p>Finally, the <code>a2F_on_trFS.x</code> utility reads the <code>mgb2_ep_interp.dat</code>, interpolates the dynamical matrix and integrates the Eliashberg function. This utility reads also the triangulation and velocity files:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span><span class="si">${</span><span class="nv">INTW_dir</span><span class="si">}</span>/a2F_on_trFS_dV.x<span class="w"> </span>&lt;<span class="w"> </span>intw.in
</code></pre></div>

<p>The first two columns of the output file <code>mgb2_a2F_interp.dat</code> contain $\alpha^2F(\omega)$. The other columns are the mode-resolved quantity.</p>
<p>Before proceeding with interpolation Method II, we rename the output to compare results later on.</p>
<div class="codehilite"><pre><span></span><code>mv imgb2_ep_interp.dat mgb2_ep_interp_dV.dat
mv mgb2_a2F_interp.dat mgb2_a2F_interp_dV.dat
</code></pre></div>

<p><a href="#electron-phonon-interpolation-with-intw">Back to top :arrow_heading_up:</a></p>
<h2 id="electron-phonon-by-method-ii">Electron-phonon by Method II</h2>
<p>To do the same calculation on the FS with Method II we have to calculate the electron-phonon matrix elements on the coarse grid given by $N_k$ and $N_q$. We do this with the <code>ep_melements.x</code> utility and updating the <code>&amp;elphon</code> block of the <code>intw.in</code> file:</p>
<div class="codehilite"><pre><span></span><code>&amp;elphon
 ep_bands = &#39;intw&#39;
 ep_mat_file = &quot;ep_mat.dat&quot;
/
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="cp">${</span><span class="n">INTW_dir</span><span class="cp">}</span>/ep_melements.x<span class="w"> </span><span class="nt">&lt; intw.in</span>
</code></pre></div>

<p>This will store the elements in files <code>ep_mat.dat_1</code> to <code>ep_mat.dat_27</code> for the coarse q-point grid. Now, we interpolate these elements from the coarse grid onto the triangulated Fermi surface by Wannier interpolation (see F. Giustino et al., Phys. Rev. B 76 (2007) 165108). To do this, we need the <code>.off</code> files and a few more lines in the <code>&amp;elphon</code> block of the <code>intw.in</code>file:</p>
<div class="codehilite"><pre><span></span><code>&amp;elphon
 ep_bands = &#39;intw&#39;
 ep_mat_file = &quot;ep_mat.dat&quot;
 ep_interp_method = &#39;wannier&#39;
 ep_interp_bands = &#39;ef_crossing&#39;
 nfs_sheets_initial = 3
 nfs_sheets_final = 5
/
</code></pre></div>

<p>We run the Wannier interpolation and the Eliashberg function calculation:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">${</span><span class="n">INTW_dir</span><span class="cp">}</span>/ep_interp_on_trFS_dV.x<span class="w"> </span><span class="nt">&lt; intw.in</span>
<span class="err">${INTW_dir}/a2F_on_trFS_dV.x</span> <span class="err">&lt;</span> <span class="err">intw.in</span>
</code></pre></div>

<p>Finally, we rename the results files:</p>
<div class="codehilite"><pre><span></span><code>mv imgb2_ep_interp.dat mgb2_ep_interp_wann.dat
mv mgb2_a2F_interp.dat mgb2_a2F_interp_wann.dat
</code></pre></div>

<p>and we are ready to compare the Eliashberg function from both methods:</p>
<div class="codehilite"><pre><span></span><code>gnuplot&gt; set ylabel &#39;a2F(omega)&#39;
gnuplot&gt; set xlabel &#39;omega(Ry)&#39;
gnuplot&gt; p &#39;mgb2_a2F_interp_dV.dat&#39; w l,&#39;mgb2_a2F_interp_wann.dat&#39; w l
</code></pre></div>

<p><img alt="image" src="mgb2_a2F.png"></p>
<p><a href="#electron-phonon-interpolation-with-intw">Back to top :arrow_heading_up:</a></p>
    </div>
  </div>
      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row justify-content-between">
          <div class="col">
            <p>
              INTW
 was developed by INTW group<br>              &copy; 2025 
</p>
          </div>
          <div class="col">
            <p class="text-end">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
            </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>
  </body>
</html>